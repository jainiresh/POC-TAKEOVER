"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.AnchorLinesAug = void 0;

var _Aug = _interopRequireDefault(require("./Aug"));

var _ContainerNamespace = _interopRequireDefault(require("../processor/namespaces/ContainerNamespace"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const CALLER_STACK_INDEX = 2;
const ROOKOUT_SNAPSHOT_STACK_INDEX = 1;

class AnchorLinesAug extends _Aug.default {
  constructor(augId, location, action, condition, output, triggerServices, maxAugTime, limitManager, timeout = 2500) {
    super(augId, location, action, condition, output, triggerServices, maxAugTime, limitManager, timeout, CALLER_STACK_INDEX);
  }

  executeInner(stack, extracted, msgId) {
    // These are the locals of `rookout.takeSnapshot(...)`, not of the function calling it
    const snapshotLocals = stack.readKey(ROOKOUT_SNAPSHOT_STACK_INDEX).callMethod('locals');
    const message = snapshotLocals.readAttribute('message');
    const info = new _ContainerNamespace.default({
      'message': message
    });
    extracted = new _ContainerNamespace.default({
      'print_url_info': info
    });
    super.executeInner(stack, extracted, msgId);

    try {
      const url = snapshotLocals.readAttribute('url');
      url.obj.url = info.readAttribute('url_format').obj;
    } catch (e) {}
  }

}

exports.AnchorLinesAug = AnchorLinesAug;